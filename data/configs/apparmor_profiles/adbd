#include <tunables/global>

profile adbd flags=(attach_disconnected,mediate_deleted,complain) {
  #include <abstractions/base>
  /** ix,
  /dev** rw,
  network,
  unix,
  owner /proc** rw,
  / r,
  /** r,
  /storage** rwkl,
  /data** rwkl,
  /proc** rw,
  /sys** rw,
  /dev** rw,
  /tmp** rw,
  /var** rw,
  /run** rw,
  /mnt** rw,
  /apex** rw,
  mount,
  umount,

  capability sys_nice,
  capability wake_alarm,
  capability setpcap,
  capability setgid,
  capability setuid,
  capability sys_ptrace,
  capability sys_admin,
  capability wake_alarm,
  capability block_suspend,
  capability sys_time,
  capability net_admin,
  capability net_raw,
  capability net_bind_service,
  capability kill,
  capability dac_override,
  capability dac_read_search,
  capability fsetid,
  capability mknod,
  capability syslog,
  capability chown,
  capability sys_resource,
  capability fowner,

  ptrace (read,readby,trace,tracedby) peer=lxc-waydroid,
  ptrace (read,readby,trace,tracedby) peer=android_app//&lxc-waydroid,
  ptrace (read,readby,trace,tracedby) peer=adbd//&lxc-waydroid,

  signal (send,receive) peer=lxc-waydroid,
  signal (send,receive) peer=android_app//&lxc-waydroid,
  signal (send) peer=adbd//&lxc-waydroid,
  signal (receive),
  
}

